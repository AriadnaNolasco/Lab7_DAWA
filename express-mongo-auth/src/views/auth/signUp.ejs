<%- include('../layouts/main', { title: 'Registrarse', body: `
<div class="row">
  <div class="col s12 m8 offset-m2">
    <div class="card z-depth-2">
      <div class="card-content">
        <span class="card-title center">Crear cuenta</span>
        <form id="signupForm">
          <div class="input-field"><input id="name" type="text" required><label for="name">Nombre</label></div>
          <div class="input-field"><input id="lastName" type="text" required><label for="lastName">Apellido</label></div>
          <div class="input-field"><input id="phoneNumber" type="text" required><label for="phoneNumber">Teléfono</label></div>
          <div class="input-field"><input id="birthdate" type="date" required><label for="birthdate">Fecha de nacimiento</label></div>
          <div class="input-field"><input id="email" type="email" required><label for="email">Correo</label></div>
          <div class="input-field"><input id="password" type="password" required><label for="password">Contraseña</label></div>
          <button class="btn green w-100" type="submit">Registrarse</button>
        </form>
        <p class="center">¿Ya tienes cuenta? <a href="/signIn">Inicia sesión</a></p>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('signupForm').addEventListener('submit', async e => {
    e.preventDefault();

    const payload = {
      name: document.getElementById('name').value,
      lastName: document.getElementById('lastName').value,
      phoneNumber: document.getElementById('phoneNumber').value,
      birthdate: document.getElementById('birthdate').value,
      email: document.getElementById('email').value,
      password: document.getElementById('password').value
    };

    const res = await fetch('/api/auth/signUp', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (res.ok) {
      M.toast({ html: 'Registro exitoso, ahora inicia sesión', classes: 'green' });
      window.location.href = '/signIn';
    } else {
      M.toast({ html: data.message || 'Error al registrarse', classes: 'red' });
    }
  });
</script>

`}) %>
