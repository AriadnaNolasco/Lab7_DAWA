<div class="row">
  <div class="col s12 m8 offset-m2">
    <div class="card z-depth-2">
      <div class="card-content">
        <span class="card-title center">Crear cuenta</span>
        <form id="signupForm">
          <div class="input-field"><input id="name" type="text" required><label for="name">Nombre</label></div>
          <div class="input-field"><input id="lastName" type="text" required><label for="lastName">Apellido</label></div>
          <div class="input-field"><input id="phoneNumber" type="text" required><label for="phoneNumber">Tel칠fono</label></div>
          <div class="input-field"><input id="birthdate" type="date" required><label for="birthdate">Fecha de nacimiento</label></div>
          <div class="input-field"><input id="email" type="email" required><label for="email">Correo</label></div>
          <div class="input-field"><input id="password" type="password" required><label for="password">Contrase침a</label></div>
          <button class="btn green w-100" type="submit">Registrarse</button>
        </form>
        <p class="center">쯏a tienes cuenta? <a href="/signIn">Inicia sesi칩n</a></p>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('signupForm').addEventListener('submit', async e => {
    e.preventDefault();

    const payload = {
      name: document.getElementById('name').value.trim(),
      lastName: document.getElementById('lastName').value.trim(),
      phoneNumber: document.getElementById('phoneNumber').value.trim(),
      birthdate: document.getElementById('birthdate').value,
      email: document.getElementById('email').value.trim(),
      password: document.getElementById('password').value
    };

    // 游댳 Validaci칩n frontend de la contrase침a
    if (!/(?=.*[A-Z])(?=.*\d)(?=.*[#$%&*@])/.test(payload.password)) {
      M.toast({ 
        html: 'La contrase침a debe tener al menos 1 may칰scula, 1 n칰mero y 1 s칤mbolo (#$%&*@)', 
        classes: 'red' 
      });
      return;
    }

    // 游댳 Enviar datos al backend
    const res = await fetch('/api/auth/signUp', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (res.ok) {
      M.toast({ html: 'Registro exitoso, ahora inicia sesi칩n', classes: 'green' });
      setTimeout(() => window.location.href = '/signIn', 1000);
    } else {
      M.toast({ html: data.message || 'Error al registrarse', classes: 'red' });
    }
  });
</script>
